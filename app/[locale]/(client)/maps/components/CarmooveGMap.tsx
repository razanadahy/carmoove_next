'use client';

import { useCallback, useState, useRef } from "react";
import {GoogleMap, useLoadScript, Marker, InfoWindow, useJsApiLoader} from "@react-google-maps/api";
import { IVehicle, IReservation } from "@/lib/hooks/Interfaces";
import {GetVehicleCarmooveType} from "@/lib/utils/VehicleType";

interface ICarmooveGMap {
    vehicles: IVehicle[];
    reservations: IReservation[];
    selectedVehicle: IVehicle | null;
    onSelectVehicle: (vehicle: IVehicle | null) => void;
}

const mapContainerStyle = {
    width: "100%",
    height: "100%",
};

const defaultCenter = {
    lat: 47.260833,
    lng:  2.418889,
};

const mapOptions: google.maps.MapOptions = {
    disableDefaultUI: false,
    zoomControl: true,
    streetViewControl: false,
    mapTypeControl: false,
    fullscreenControl: true,
};

const getMarkerColor = (vehicle: IVehicle): string => {
    if (vehicle.stateCS?.state?.unavailable) return "#ff4d4f";
    if (vehicle.status?.engine === "ON") return "#52c41a";
    return "#1890ff";
};

const getOutlineColor = (isSelected: boolean): string => {
    return isSelected ? "#6bbec4" : "#ffffff";
};

const createVehicleIcon = (fill: string, outline: string, type: string): string => {
    let baseIcon = ''
    switch (type) {
        case 'VP':
            baseIcon = `
          <path fill="white" transform="translate(39.0263 29.4128)" d="M2.9917638 0C2.9123602 0 2.8337796 0.0028769232 2.7560217 0.0090417583C2.7325709 0.011096703 2.7091203 0.013151648 2.6860809 0.015617582C2.6679785 0.017261539 2.6502876 0.019316483 2.633008 0.021371428L2.6025631 0.02507033C2.5844607 0.027536264 2.5663586 0.030002197 2.5482562 0.032879122C2.529331 0.035756044 2.5104058 0.038632967 2.4914806 0.041920878C2.4511616 0.048496705 2.4108429 0.056305494 2.3709354 0.064936265C2.325268 0.074389011 2.2804236 0.085074723 2.2355793 0.09658242L2.2351677 0.09658242C2.1977289 0.10644615 2.1602898 0.11713187 2.1232624 0.12822857C2.1010458 0.1348044 2.0788293 0.14179121 2.0570242 0.14918901C2.0372763 0.15535384 2.0179396 0.16192967 1.998603 0.16891648L1.9405931 0.18987693C1.9212565 0.19727473 1.9023314 0.20467253 1.8834062 0.21207033C1.8451444 0.22727692 1.8077054 0.24330549 1.7702665 0.25974506C1.7373531 0.27454066 1.7044398 0.29015824 1.6719378 0.30618683C1.6587725 0.31235164 1.6460185 0.31851649 1.6332647 0.32550329C1.6056997 0.33947691 1.5785462 0.35386154 1.5518041 0.36865714C1.534113 0.37852088 1.5164222 0.38838461 1.4987313 0.39865935C1.4458539 0.42863855 1.3941164 0.46058097 1.343627 0.49441978C1.3271704 0.5051055 1.3107136 0.51620221 1.2942569 0.52729893C1.2934341 0.52812088 1.2926112 0.52853185 1.2917885 0.52935386C1.2757432 0.54045057 1.2596979 0.55154723 1.2440641 0.56305492C1.2255503 0.57620656 1.2070365 0.58976924 1.1889342 0.60374284C1.1589007 0.62634724 1.1292787 0.6497736 1.1000681 0.67361099C1.0844343 0.68635166 1.0688004 0.69909233 1.053578 0.71224397C1.0391784 0.72416264 1.0251902 0.73649234 1.011202 0.74882197C0.99433392 0.76361758 0.97787726 0.77841318 0.96183199 0.79361975C0.9474324 0.80677146 0.9334442 0.82033408 0.91904461 0.8338967C0.88983399 0.86143297 0.8614462 0.89020222 0.83388126 0.91897142C0.82153875 0.93171209 0.80919623 0.94486374 0.79726517 0.95760441C0.77998567 0.97650987 0.7627061 0.99541539 0.74583805 1.0143209C0.73472977 1.0274725 0.7232101 1.0402132 0.71210182 1.0533649C0.69893646 1.0689824 0.68618256 1.0841891 0.6734286 1.0998065C0.60944945 1.177886 0.5495761 1.2592345 0.49405077 1.343523C0.45949176 1.3953077 0.42657837 1.4487363 0.3953107 1.5029868C0.383791 1.5235362 0.37227133 1.5436747 0.36116308 1.5642241C0.3500548 1.5847737 0.33894655 1.6057341 0.32824969 1.6266946C0.32166705 1.6394352 0.31508437 1.6521758 0.30891311 1.6649165C0.28283569 1.717692 0.25814223 1.7711388 0.23485804 1.8252022C0.22704111 1.8441077 0.21922418 1.8634242 0.21181868 1.8823297C0.20400175 1.9016461 0.19659625 1.9205517 0.18960215 1.9398681C0.18425374 1.9534308 0.17931673 1.9669935 0.17479114 1.980556C0.16985413 1.9937077 0.16491714 2.0072703 0.16039155 2.021244C0.1193561 2.1407628 0.086099096 2.2628071 0.060828619 2.3866131C0.055891614 2.4108615 0.05095461 2.4351099 0.04684044 2.4597692C0.042314854 2.4840176 0.03820068 2.508677 0.034497928 2.5337472C0.030795174 2.5571737 0.027503839 2.5806 0.024623919 2.6040263C0.022566833 2.620466 0.020509748 2.6364944 0.01886408 2.6529341C0.015572743 2.6812923 0.012692824 2.7100616 0.010635739 2.7388308C0.0089900708 2.7536263 0.0077558192 2.7684219 0.006932985 2.7832177L0.005698734 2.8054111C0.0044644829 2.8230834 0.0036416489 2.841167 0.0028188147 2.8592505C0.0015845635 2.8806219 0.0011731464 2.9019935 0.00076172943 2.9237759C-0.0029579708 3.0876131 0.0069500934 3.2514758 0.030383758 3.4136748C0.036966432 3.4588835 0.044371936 3.5040922 0.053011697 3.5488901C0.055891614 3.5657406 0.059182953 3.5821803 0.062885702 3.5990307C0.063297123 3.6014967 0.063708536 3.6043737 0.064531371 3.6068397C0.068645544 3.6261561 0.072759718 3.6454725 0.077285305 3.664789C0.081399471 3.6841054 0.086336479 3.703011 0.090862066 3.7219164L0.09333057 3.7305472C0.12148052 3.8409824 0.15609916 3.9496708 0.19700767 4.0560508C0.20605884 4.0802989 0.21593285 4.104547 0.22580686 4.1287956C0.25913966 4.2097197 0.2960667 4.2891192 0.33647805 4.3667583C0.83511555 5.3239517 1.8369161 5.9840002 2.9917638 5.9840002C4.1515484 5.9840002 5.1566405 5.3186088 5.6536322 4.3552504C5.6598034 4.3433318 5.6659746 4.3305912 5.6717343 4.3182616C5.6840768 4.293602 5.6960082 4.2689428 5.7071161 4.2442837C5.7149334 4.2282548 5.7223387 4.2118154 5.7293329 4.1953759C5.7745028 4.0937328 5.8137894 3.9895809 5.8469982 3.8834352C5.8696022 3.8117361 5.8895016 3.7392139 5.9066534 3.6660221C5.9120021 3.6425955 5.9173503 3.6187582 5.9222875 3.5953319C5.9235215 3.5883451 5.9247561 3.5817692 5.9259901 3.5751934C5.9305158 3.5542331 5.9346299 3.5328615 5.9379215 3.5119011L5.9403896 3.4999824C5.9449153 3.4724462 5.949441 3.444499 5.9535551 3.4165516C5.9737144 3.2768154 5.9840002 3.1337912 5.9840002 2.9887121C5.9840002 1.3381802 4.6444259 0 2.9917638 0L2.9917638 0ZM3.7952611 3.4054549C3.6442711 3.6952021 3.3414683 3.8928878 2.9917638 3.8928878C2.6424706 3.8928878 2.3392563 3.6952021 2.1886775 3.4054549C2.1214979 3.2768021 2.0864906 3.1338165 2.0866456 2.9887121C2.0866456 2.4893603 2.4918921 2.0845363 2.9917638 2.0845363C3.4916356 2.0845363 3.8968813 2.4893603 3.8968813 2.9887121C3.8968813 3.1391342 3.8602653 3.2809253 3.7952611 3.4054549L3.7952611 3.4054549Z" fill-rule="evenodd" />
          <path fill="white" transform="translate(12.996 21.484)" d="M35.883961 7.7692695C35.493748 6.0801787 35.277912 5.1908755 35.236446 5.1013598C35.174679 4.9662237 35.092033 4.5519199 34.991074 4.44312L34.896503 4.3383999L30.338064 4.1178031C28.494667 1.3996567 27.206327 0.040583488 26.473047 0.040583488L17.06922 0C16.516844 0 13.993869 1.4433268 9.5002947 4.3299804L3.5504022 4.7561145C2.5791302 4.8256259 1.6815556 5.2647119 1.022539 5.9930673C0.59995049 6.4606481 0.295789 6.2834158 0.14285627 6.8956318C0.069491982 7.1896033 0.030599566 7.4913201 0.026985224 7.7945271L0.00014744561 9.0351486C-0.0062425015 9.5718088 0.19525383 10.077384 0.56714875 10.459047C0.9394697 10.840712 1.4357556 11.050971 1.9652692 11.050971L3.9763958 11.050971C4.0252557 10.622778 3.9763958 10.622778 4.0265336 10.40508C4.0358572 10.364595 4.0510278 10.321675 4.0582781 10.280736C4.2134733 9.4043798 5.2790961 7.5406604 7.3396411 7.5406604C9.4001856 7.5406604 10.68236 8.7803059 10.920525 10.280736C10.924904 10.308328 10.924193 10.349775 10.918394 10.40508L10.954329 10.723012L10.954329 10.808868C10.963701 10.918749 10.962992 10.99945 10.9522 11.050971L25.515369 11.050971C25.504862 11.000313 25.504862 10.825906 25.515369 10.52775L25.558195 10.40508C26.03026 9.1631622 26.349781 8.3722486 27.892267 7.7358093C28.067526 7.663497 28.316986 7.6270094 28.538931 7.6019683C28.677805 7.5855618 28.820732 7.5709858 28.96237 7.5773587C31.005457 7.6692824 31.85169 8.4322977 32.463985 10.18312C32.465919 10.259133 32.479504 10.354347 32.504738 10.468762L32.540417 10.9208L34.407883 10.36728L34.417683 10.361472C35.408123 10.018234 36.02454 8.9280758 35.883961 7.7692695ZM0.87344027 9.1631622L0.87344027 8.515543L2.2174592 8.515543L2.2174592 9.1631622L0.87344027 9.1631622ZM3.4997087 6.5912509C3.2535207 6.9404941 2.8560877 7.1477618 2.4325874 7.1477714L0.99144125 7.1477714C1.1107203 6.6698284 1.3458704 6.2372189 1.6653677 5.8836188L3.4835207 5.8836188C3.699075 5.8836188 3.8243179 6.1305776 3.699075 6.3084574L3.4997087 6.5912509ZM19.339109 5.5352001L17.578041 5.5352001L17.578041 5.0507808L19.339109 5.0507808L19.339109 5.5352001ZM20.223297 4.141583L11.364737 4.141583L15.807173 1.3179047C16.326036 1.0096381 16.918173 0.84643811 17.51755 0.84643811L20.352556 0.85593653C20.338072 1.402527 20.294985 2.4977424 20.223297 4.141583ZM27.453491 5.5352001L25.698385 5.5352001L25.698385 5.0507808L27.453491 5.0507808L27.453491 5.5352001ZM21.536825 3.5690286C21.576017 2.6014857 21.609245 1.6810032 21.630972 0.86025399L26.314802 0.87622857L28.520548 4.1178031L21.536825 4.1178031L21.536825 3.5690286ZM34.067085 6.96946C33.85281 6.960825 33.541985 6.8380671 33.433784 6.6502576L33.23682 6.4107809C33.093685 6.1629586 33.270046 5.8512383 33.553333 5.8512383L34.723549 5.8512383L34.900337 7.0035686L34.067085 6.96946Z" fill-rule="evenodd" />
          <path fill="white" transform="translate(17.484 29.4128)" d="M2.9920001 0C1.3396524 0 0 1.3396524 0 2.9920001C0 3.1801839 0.017802734 3.3679457 0.053075906 3.5527942C0.055955995 3.5696633 0.059247524 3.5861211 0.062950492 3.6029902C0.063361935 3.6054587 0.063773379 3.6083388 0.064596258 3.6108074C0.06871067 3.6301453 0.072825082 3.649483 0.077350937 3.6688206C0.081465349 3.6881585 0.08640264 3.7070847 0.090928495 3.726011L0.093397141 3.7346513C0.099157318 3.7572806 0.10491749 3.7799098 0.11150055 3.8025391C0.13289548 3.87989 0.15799341 3.9560065 0.18555996 4.0304775C0.19173157 4.0473466 0.19790319 4.0642157 0.20448625 4.0806732C0.22876127 4.1423893 0.25468206 4.2032828 0.28307152 4.2629418C0.29047745 4.2793994 0.29829484 4.295857 0.30652365 4.3123145C0.31639823 4.3320637 0.32627282 4.3518128 0.33655885 4.371562C0.83522552 5.3298087 1.8370847 5.9840002 2.9920001 5.9840002C4.1518526 5.9840002 5.1570034 5.32446 5.6540241 4.3600416C5.6601958 4.3481102 5.6663675 4.3357668 5.6721277 4.3230119C5.680768 4.3057318 5.6894083 4.2880397 5.6976371 4.2703476C5.7050428 4.2551241 5.7120376 4.2399011 5.7190318 4.2246776C5.7215004 4.2193289 5.723969 4.2139802 5.7260265 4.2086315C5.7330208 4.193408 5.739604 4.1785965 5.7457757 4.163373C5.7626448 4.1238747 5.7786908 4.0843763 5.7939143 4.044055C5.7996745 4.0288315 5.8050232 4.0136085 5.8103719 3.998385C5.8247724 3.9584754 5.8383498 3.918154 5.8511047 3.8770099C5.8585105 3.8527348 5.8655047 3.8284597 5.8724995 3.8037734C5.8794937 3.7778525 5.8864884 3.7519319 5.8930717 3.726011C5.903769 3.6832211 5.9136434 3.6400199 5.9226952 3.5964069C5.9231067 3.5951726 5.9235182 3.5935268 5.9235182 3.5922925C5.9268098 3.5766578 5.9301014 3.561023 5.93257 3.5453882C5.9358616 3.5289307 5.9391527 3.5120616 5.9416218 3.495604C5.9461474 3.4696832 5.9502616 3.4437623 5.9539647 3.4174302C5.9737139 3.278363 5.9840002 3.136416 5.9840002 2.9920001C5.9840002 1.3396524 4.6447592 0 2.9920001 0ZM3.7955446 3.4096127C3.6445456 3.6992674 3.3417249 3.8971705 2.9920001 3.8971705C2.6426864 3.8971705 2.3394544 3.6992674 2.1888669 3.4096127C2.1215398 3.2807248 2.0865238 3.137413 2.0868275 2.9920001C2.0868275 2.492099 2.492099 2.0868294 2.9920001 2.0868294C3.4919009 2.0868294 3.8971705 2.492099 3.8971705 2.9920001C3.8971705 3.1425874 3.8605523 3.2845347 3.7955446 3.4096127L3.7955446 3.4096127Z" fill-rule="evenodd" />
        `
            break
        case 'carType.berline':
            baseIcon = `
          <path fill="none" stroke="white" stroke-width="3" stroke-miterlimit="10" transform="translate(5.5 3.5)" d="M25.431999 53.855999C34.545868 53.855999 50.863998 38.584545 50.863998 24.856615C50.863998 11.128686 39.477707 0 25.431999 0C11.386294 0 0 11.128686 0 24.856615C0 38.584545 16.318134 53.855999 25.431999 53.855999Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(38.8607 28.6618)" d="M3.0977831 0C3.0155659 0 2.9342005 0.0030222223 2.8536873 0.0094984127C2.8294053 0.011657143 2.8051236 0.013815873 2.7812679 0.01640635C2.7625239 0.018133333 2.7442062 0.020292064 2.7263143 0.022450794L2.6947906 0.026336508C2.6760466 0.028926983 2.6573029 0.031517461 2.6385589 0.034539681C2.6189632 0.037561905 2.5993674 0.040584128 2.5797715 0.044038095C2.5380237 0.050946031 2.4962761 0.059149206 2.4549544 0.068215869C2.4076688 0.078146033 2.3612351 0.089371428 2.3148017 0.10146032L2.3143756 0.10146032C2.27561 0.11182223 2.2368443 0.12304762 2.1985047 0.13470477C2.1755009 0.14161269 2.1524971 0.14895238 2.1299191 0.15672381C2.1094713 0.16320001 2.0894494 0.17010793 2.0694277 0.17744762L2.0093622 0.19946666C1.9893403 0.20723809 1.9697444 0.21500953 1.9501487 0.22278096C1.9105309 0.23875555 1.8717653 0.25559366 1.8329996 0.27286348C1.7989199 0.28840634 1.7648401 0.3048127 1.7311865 0.3216508C1.7175546 0.328127 1.7043487 0.33460316 1.6911428 0.34194285C1.662601 0.35662222 1.6344852 0.37173334 1.6067954 0.3872762C1.5884776 0.39763808 1.5701598 0.40799999 1.551842 0.41879365C1.4970908 0.45028695 1.4435199 0.48384264 1.3912413 0.51939046C1.3742014 0.53061587 1.3571615 0.54227304 1.3401216 0.55393016C1.3392696 0.55479366 1.3384176 0.55522537 1.3375657 0.55608886C1.3209518 0.56774604 1.304338 0.57940316 1.2881501 0.59149206C1.2689803 0.60530794 1.2498105 0.61955553 1.2310666 0.63423491C1.1999688 0.65798098 1.1692971 0.68259048 1.1390513 0.70763177C1.1228634 0.72101587 1.1066756 0.73439997 1.0909138 0.74821585C1.0760039 0.76073653 1.06152 0.77368891 1.0470361 0.78664124C1.0295702 0.8021841 1.0125303 0.81772697 0.99591649 0.83370161C0.98100662 0.84751743 0.96652275 0.86176509 0.95161289 0.87601268C0.92136711 0.90493971 0.89197338 0.93516189 0.86343163 0.96538413C0.85065174 0.97876823 0.83787179 0.99258411 0.82551789 1.0059682C0.80762607 1.0258286 0.78973424 1.0456889 0.77226835 1.0655493C0.76076645 1.0793651 0.74883854 1.0927492 0.73733664 1.1065651C0.72370476 1.1229714 0.71049887 1.1389461 0.69729298 1.1553524C0.63104659 1.2373751 0.56905144 1.3228322 0.51155853 1.4113778C0.47577479 1.4657778 0.44169509 1.5219047 0.40931934 1.5788952C0.39739144 1.6004826 0.38546354 1.6216381 0.37396166 1.6432254C0.36245975 1.6648127 0.35095784 1.6868317 0.33988193 1.7088507C0.33306599 1.722235 0.32625005 1.7356191 0.3198601 1.7490032C0.29285857 1.8044442 0.26729006 1.8605902 0.24318072 1.9173841C0.23508678 1.9372444 0.22699286 1.9575365 0.21932492 1.9773968C0.21123099 1.9976889 0.20356305 2.0175493 0.19632111 2.0378413C0.19078316 2.052089 0.1856712 2.0663364 0.18098524 2.080584C0.17587328 2.0943999 0.17076132 2.1086476 0.16607536 2.123327C0.12358574 2.2488823 0.089150198 2.3770905 0.062984213 2.5071492C0.057872251 2.5326223 0.052760296 2.5580952 0.048500329 2.5840001C0.043814369 2.609473 0.039554402 2.6353779 0.035720434 2.6617143C0.031886466 2.6863239 0.028478494 2.7109334 0.025496518 2.7355428C0.023366537 2.7528126 0.021236554 2.7696507 0.019532569 2.7869205C0.016124597 2.8167112 0.013142621 2.8469334 0.011012639 2.8771555C0.009308653 2.8926985 0.0080306632 2.9082413 0.0071786703 2.923784L0.0059006806 2.9470985C0.0046226913 2.9656634 0.0037706983 2.9846604 0.0029187053 3.0036571C0.0016407159 3.026108 0.0012147194 3.0485587 0.00078872289 3.0714412C-0.0030627926 3.2435532 0.0071963845 3.4156919 0.031460471 3.5860825C0.038276415 3.6335745 0.045944352 3.6810668 0.054890275 3.728127C0.057872251 3.7458286 0.061280224 3.7630985 0.065114193 3.7808001C0.065540187 3.7833905 0.065966189 3.7864127 0.066818178 3.7890031C0.071078144 3.8092952 0.07533811 3.8295872 0.080024071 3.8498793C0.084284037 3.8701715 0.089395992 3.8900318 0.094081953 3.9098921L0.096637934 3.9189587C0.12578544 4.0349712 0.16163087 4.1491489 0.20398904 4.2609015C0.21336097 4.2863746 0.22358489 4.3118477 0.2338088 4.3373208C0.2683228 4.4223318 0.30655843 4.5057416 0.34840184 4.5873017C0.86470962 5.5928383 1.902011 6.2862225 3.0977831 6.2862225C4.2986674 6.2862225 5.3393769 5.5872254 5.8539805 4.5752125C5.8603702 4.5626922 5.8667603 4.5493078 5.8727241 4.5363555C5.8855042 4.5104508 5.8978581 4.4845462 5.9093599 4.4586411C5.9174538 4.441803 5.9251218 4.4245334 5.932364 4.4072633C5.9791346 4.3004866 6.0198131 4.1910748 6.0541987 4.0795684C6.0776038 4.0042481 6.0982084 3.9280632 6.1159682 3.8511746C6.1215062 3.826565 6.1270442 3.8015239 6.1321564 3.7769144C6.1334343 3.7695746 6.1347122 3.7626667 6.1359901 3.7557588C6.140676 3.7337396 6.1449361 3.7112889 6.148344 3.6892698L6.1508999 3.6767492C6.1555858 3.6478221 6.1602721 3.6184635 6.1645317 3.5891047C6.1854057 3.442311 6.1960554 3.2920635 6.1960554 3.1396573C6.1960554 1.4057651 4.809011 0 3.0977831 0L3.0977831 0ZM3.9297543 3.5774477C3.7734137 3.8818285 3.4598801 4.0894985 3.0977831 4.0894985C2.7361121 4.0894985 2.4221528 3.8818285 2.266238 3.5774477C2.1966777 3.4422972 2.16043 3.2920899 2.1605904 3.1396573C2.1605904 2.6150856 2.5801973 2.1898158 3.0977831 2.1898158C3.6153688 2.1898158 4.0349755 2.6150856 4.0349755 3.1396573C4.0349755 3.2976761 3.9970617 3.4466286 3.9297543 3.5774477L3.9297543 3.5774477Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(12.996 19.988)" d="M35.884102 9.2652702L35.357143 4.9301081C35.339252 4.7820191 35.298782 4.6386795 35.236588 4.5044065C35.17482 4.3692698 35.092175 4.2453589 34.991215 4.1365585L34.896641 4.034235L34.882584 4.034235L32.381557 1.3237333C31.628824 0.50816506 30.565109 0.040584128 29.465187 0.040584128L17.519819 0C16.691257 0 15.875473 0.22450794 15.160651 0.64934605L9.4927683 4.0178285L9.5004358 4.0307808L3.5505431 4.4569144C2.5792711 4.5264254 1.6816964 4.9655113 1.0226798 5.6938667C0.60009134 6.1614475 0.29592982 6.7322159 0.14299709 7.3444319C0.069632798 7.6384034 0.030740382 7.9401197 0.02712604 8.2433271L0.00014081615 10.531149C-0.0061016856 11.067809 0.19539465 11.573384 0.56728959 11.955048C0.93961054 12.336711 1.4358964 12.546971 1.96541 12.546971L3.680898 12.546971C3.6370699 12.333747 3.6116977 12.117051 3.6050706 11.899352C3.6037924 11.858768 3.6029406 11.817753 3.6029406 11.776736C3.6029406 9.6883812 5.2792368 7.9894605 7.3397818 7.9894605C9.4003267 7.9894605 11.076623 9.6883812 11.076623 11.776736C11.076623 11.818184 11.075771 11.859632 11.074492 11.901079C11.071085 12.009016 11.062991 12.117384 11.050211 12.224889C11.047229 12.25468 11.043395 12.28447 11.039135 12.31426C11.028059 12.392838 11.014853 12.470984 10.998666 12.548266L25.303627 12.582375C25.287867 12.506388 25.27466 12.429537 25.264009 12.352686C25.259323 12.321168 25.255489 12.289651 25.252083 12.258133C25.238876 12.15106 25.230782 12.042692 25.2278 11.934324C25.226097 11.894172 25.22567 11.853587 25.22567 11.813435C25.22567 10.101994 26.35158 8.6517591 27.892408 8.1846094C28.100721 8.1211424 28.317127 8.0758095 28.53907 8.0507679C28.677946 8.0343618 28.819376 8.0261583 28.962511 8.0261583C30.990681 8.0261583 32.646954 9.6719742 32.698502 11.715428L32.698502 11.71586C32.701401 11.82945 32.699268 11.943112 32.692112 12.056508C32.685936 12.156464 32.675846 12.256132 32.661865 12.355276L32.654198 12.407085L34.408024 11.860496L34.417824 11.857473C35.408264 11.514235 36.024681 10.424076 35.884102 9.2652702ZM2.2175999 9.6119623L0.87358105 9.6119623L0.87358105 8.9643431L2.2175999 8.9643431L2.2175999 9.6119623L2.2175999 9.6119623ZM3.6992157 6.757257L3.4998493 7.040051C3.2536616 7.3892941 2.8562286 7.5965714 2.4327283 7.5965714L0.9915821 7.5965714C1.1108611 7.1186285 1.3460112 6.6860189 1.6655085 6.3324189L3.4836614 6.3324189C3.6992157 6.3324189 3.8244588 6.5793777 3.6992157 6.757257L3.6992157 6.757257ZM19.339251 6.1472001L17.578182 6.1472001L17.578182 5.4995809L19.339251 5.4995809L19.339251 6.1472001ZM20.2577 4.0152383L12.053007 3.9979682L15.807314 1.7667048C16.326178 1.458438 16.918312 1.2952381 17.517691 1.2952381L20.352695 1.3047365C20.330971 2.1246221 20.297318 3.0459683 20.2577 4.0152383L20.2577 4.0152383ZM27.453632 6.1472001L25.698526 6.1472001L25.698526 5.4995809L27.453632 5.4995809L27.453632 6.1472001ZM21.536966 4.0178285C21.576159 3.0502858 21.609386 2.1298032 21.631111 1.309054L26.314943 1.3250285L28.06451 4.0312128L21.536966 4.0178285L21.536966 4.0178285ZM29.59469 4.034235L27.846401 1.3302095L29.463057 1.3358222C30.212385 1.3358222 30.936153 1.654019 31.447775 2.2088127L33.132164 4.034235L29.59469 4.034235L29.59469 4.034235ZM34.067226 7.7174602C33.852951 7.7088256 33.658272 7.590095 33.550068 7.4022856L33.236961 6.859581C33.093826 6.6117587 33.270187 6.3000379 33.553474 6.3000379L34.723686 6.3000379L34.900475 7.7515683L34.067226 7.7174602Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(17.2379 28.6251)" d="M3.0978465 0C1.3870445 0 0 1.4057651 0 3.1396573C0 3.3371279 0.018432533 3.5341561 0.054953545 3.728127C0.057935521 3.7458286 0.061343495 3.7630985 0.065177463 3.7808001C0.065603457 3.7833905 0.066029452 3.7864127 0.066881448 3.7890031C0.071141414 3.8092952 0.075401381 3.8295872 0.080087341 3.8498793C0.084347308 3.8701715 0.089459263 3.8900318 0.094145223 3.9098921L0.096701205 3.9189587C0.10266516 3.9427047 0.10862911 3.9664507 0.11544505 3.9901969C0.13759686 4.0713649 0.16358265 4.151238 0.19212441 4.2293839C0.19851436 4.2470856 0.2049043 4.2647872 0.21172026 4.2820573C0.23685405 4.3468189 0.26369181 4.4107175 0.29308558 4.4733205C0.30075353 4.4905906 0.30884746 4.5078602 0.31736737 4.5251303C0.3275913 4.5458541 0.33781523 4.5665779 0.34846511 4.5873017C0.86477286 5.5928383 1.9020743 6.2793145 3.0978465 6.2793145C4.2987304 6.2793145 5.3394399 5.5872254 5.8540435 4.5752125C5.8604336 4.5626922 5.8668237 4.5497398 5.8727875 4.5363555C5.8817334 4.5182223 5.8906794 4.4996572 5.8991995 4.481092C5.9068675 4.4651175 5.9141092 4.4491429 5.921351 4.4331684C5.9239073 4.4275556 5.9264631 4.4219427 5.9285932 4.4163303C5.9358349 4.4003553 5.9426508 4.3848128 5.9490409 4.3688383C5.966507 4.3273907 5.9831204 4.285943 5.9988823 4.2436318C6.0048466 4.2276573 6.0103846 4.2116823 6.0159225 4.1957078C6.0308323 4.1538286 6.0448899 4.1115174 6.0580959 4.0683427C6.065764 4.04287 6.0730057 4.0173969 6.0802479 3.991492C6.0874896 3.964292 6.0947318 3.9370921 6.1015477 3.9098921C6.1126237 3.8649905 6.1228476 3.8196571 6.1322193 3.7738922C6.1326456 3.7725968 6.1330714 3.7708697 6.1330714 3.7695746C6.1364794 3.7531683 6.1398873 3.7367618 6.1424432 3.7203555C6.1458511 3.7030857 6.1492591 3.685384 6.1518154 3.6681142C6.1565013 3.6409142 6.1607614 3.6137142 6.1645951 3.5860825C6.1850429 3.4401524 6.195693 3.2911999 6.195693 3.1396573C6.195693 1.4057651 4.8090744 0 3.0978465 0ZM3.9298177 3.5778794C3.7734768 3.8818285 3.4599435 4.0894985 3.0978465 4.0894985C2.7361755 4.0894985 2.4222159 3.8818285 2.2663014 3.5778794C2.1965926 3.4426305 2.1603377 3.2922463 2.1606522 3.1396573C2.1606522 2.6150856 2.5802608 2.1898158 3.0978465 2.1898158C3.6154323 2.1898158 4.0350389 2.6150856 4.0350389 3.1396573C4.0350389 3.2976761 3.9971251 3.4466286 3.9298177 3.5778794L3.9298177 3.5778794Z" fill-rule="evenodd"/>
        `
            break
        case 'carType.utility':
        case 'VUL':
            baseIcon = `
          <path fill="white" transform="translate(12.996 18.4931)" d="M10.280767 6.5984998C10.000385 6.5984998 9.8642769 6.2471199 10.067759 6.0487266L14.705818 1.50208C14.763664 1.4461945 14.839885 1.414759 14.918827 1.414759L19.869085 1.414759C19.997026 1.414759 20.112038 1.4957929 20.158316 1.6187409L19.808346 6.1653876C19.887289 6.3742595 19.736889 6.5984998 19.519117 6.5984998L10.280767 6.5984998ZM33.278755 4.2650743e-07C30.748522 0.0019688376 29.370787 0.002953043 29.145544 0.002953043L14.556099 0.002953043C14.206981 0.002953043 13.866711 0.12869528 13.599257 0.35782561C12.702304 1.1262504 11.806712 1.9156322 10.936299 2.7050142C9.8882656 3.6564639 8.8409128 4.6400476 7.8241839 5.62922C6.2480502 6.081892 4.7746782 6.8049097 3.4442198 7.7773166C2.2335367 8.6631012 1.1718922 9.7354031 0.28786898 10.964184C0.099359035 11.225449 0 11.539105 0 11.870227L0 14.820279C0 15.664848 0.6696527 16.35224 1.4924271 16.35224L3.9083488 16.35224C4.2724385 18.118917 5.7709904 19.446896 7.5587726 19.446896C9.3465548 19.446896 10.845107 18.118917 11.208516 16.35224L23.974791 16.35224C24.123148 17.079449 24.466143 17.747978 24.975866 18.287971C25.682268 19.03474 26.623457 19.446896 27.625216 19.446896C28.627651 19.446896 29.568161 19.03474 30.274563 18.287971C30.78701 17.745184 31.131363 17.072462 31.27836 16.341063C31.336206 16.334076 31.392691 16.322899 31.449177 16.308928L34.762051 15.488809C35.434425 15.321851 35.903999 14.709207 35.903999 13.998763L35.903999 11.714446C35.903999 10.971869 35.389511 10.343856 34.689232 10.209032L34.689228 1.4097687C34.691177 0.6331262 34.063164 0.00195326 33.286522 4.4272529e-06C33.283932 -2.0702e-06 33.281345 -1.415887e-06 33.278755 6.3901848e-06L33.278755 4.2650743e-07Z" fill-rule="evenodd"/>
        `
            break
        case 'carType.ship':
            baseIcon = `
          <path fill="white" transform="translate(19.5734 15.842)" d="M20.198614 22.440001C18.751234 22.440001 17.303854 21.97998 16.002335 21.160919C15.822814 21.048719 15.587194 21.048719 15.407674 21.160919C12.815854 22.810261 9.6181545 22.810261 7.0263343 21.160919C6.8468142 21.048719 6.6111941 21.048719 6.4316745 21.160919C5.1413741 21.97998 3.6939943 22.440001 0.0026142541 22.440001L1.1246142 22.440001C0.50751424 22.440001 0.0026142541 22.944901 0.0026142541 23.562C0.0026142541 24.1791 0.50751424 24.684 1.1246142 24.684L0.0026142541 24.684C3.7949743 24.684 5.3208942 24.2913 6.7346144 23.573219C9.5620546 25.020599 12.883174 25.020599 15.710614 23.573219C17.124334 24.302521 18.650255 24.684 20.198614 24.684L21.320614 24.684C21.937714 24.684 22.442614 24.1791 22.442614 23.562C22.442614 22.944901 21.937714 22.440001 21.320614 22.440001L20.198614 22.440001ZM2.1905143 20.195999L2.2466142 20.195999C3.8398542 20.195999 5.2760143 19.410601 6.3531342 18.355921C6.5663142 18.153959 6.914134 18.153959 7.1273141 18.355921C8.1932144 19.410601 9.6293745 20.195999 11.222614 20.195999C12.815854 20.195999 14.252014 19.410601 15.329134 18.355921C15.542315 18.14274 15.878914 18.14274 16.103313 18.355921C17.169214 19.410601 18.605373 20.195999 20.198614 20.195999L20.254715 20.195999L22.375294 12.70104C22.465054 12.40932 22.442614 12.09516 22.307974 11.82588C22.173334 11.5566 21.926495 11.35464 21.634775 11.26488L20.198614 10.79364L20.198614 5.6100001C20.198614 4.3758001 19.188814 3.3659999 17.954615 3.3659999L14.588614 3.3659999L14.588614 1.122C14.588614 0.50489998 14.083714 0 13.466615 0L8.9786139 0C8.3615141 0 7.8566141 0.50489998 7.8566141 1.122L7.8566141 3.3659999L4.4906144 3.3659999C3.2564142 3.3659999 2.2466142 4.3758001 2.2466142 5.6100001L2.2466142 10.79364L0.79923427 11.26488C0.50751424 11.35464 0.26067427 11.5566 0.12603426 11.82588C-0.0086057456 12.09516 -0.042265747 12.40932 0.058714256 12.70104L2.1905143 20.195999ZM5.6126142 5.6100001L16.832615 5.6100001C17.449715 5.6100001 17.954615 6.1149001 17.954615 6.7319999L17.954615 10.06434L11.918254 8.0783997C11.458234 7.9325399 10.975774 7.9325399 10.515755 8.0783997L4.4906144 10.06434L4.4906144 6.7319999C4.4906144 6.1149001 4.9955144 5.6100001 5.6126142 5.6100001Z" fill-rule="evenodd"/>
        `
            break
        case 'carType.scooter':
            baseIcon = `
          <path fill="white" transform="translate(17.732 16.996)" d="M3.8194451 22.418756C5.4294925 22.414316 6.862752 21.417048 7.3994303 19.927782L18.025131 19.927782C18.60866 21.578352 20.280081 22.611889 22.049604 22.416351C23.81913 22.220812 25.214336 20.848404 25.409004 19.111841C25.603674 17.37528 24.545834 15.738188 22.861919 15.170025L22.861919 2.4909728L25.400915 2.4909728L25.400915 0L17.783926 0L17.783926 2.4909728L20.322924 2.4909728L20.322924 15.170025C19.244719 15.546638 18.396309 16.378998 18.012436 17.43681L7.3994303 17.43681C6.7533689 15.644059 4.8380094 14.613262 2.9497867 15.042126C1.0615641 15.470989 -0.19721074 17.222713 0.025479738 19.111622C0.24817023 21.00053 1.8812915 22.424095 3.8194451 22.418756Z" fill-rule="evenodd"/>
        `
            break
        case 'carType.moto':
            baseIcon = `
          <path fill="white" transform="translate(42.6795 34.5949)" d="M1.563574 0.79769254C1.563574 1.238246 1.2135561 1.5953851 0.78178698 1.5953851C0.35001796 1.5953851 0 1.238246 0 0.79769254C0 0.35713911 0.35001796 0 0.78178698 0C1.2135561 0 1.563574 0.35713911 1.563574 0.79769254Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(29.3891 21.8165)" d="M18.76289 13.57614C18.765184 15.920115 17.103413 17.920898 14.836907 18.303043C12.570404 18.685188 10.366148 17.336237 9.6292944 15.116111C8.8924417 12.895986 9.8398314 10.458017 11.867526 9.3563471L12.649313 11.701563C11.751167 12.42107 11.491409 13.696014 12.034101 14.721146C12.576794 15.746277 13.764194 16.223623 14.846344 15.851692C15.928493 15.479763 16.590847 14.366666 16.415066 13.215429C16.239283 12.064193 15.276459 11.209444 14.134708 11.191039L13.352921 8.8538008C14.705169 8.6397038 16.081621 9.0388002 17.121458 9.9464703C18.161295 10.85414 18.760824 12.179872 18.76289 13.57614ZM18.536169 3.2859068C18.254726 4.1553917 18.293816 4.00383 17.9811 4.00383C17.350737 4.0011296 16.783613 3.6124613 16.542742 3.0180755C16.30187 2.4236894 16.434364 1.7398509 16.87878 1.2836984C17.386942 0.76519835 17.84038 0.81305987 18.653437 0.81305987C18.831335 1.6332493 18.790846 2.4870741 18.536169 3.2859068L18.536169 3.2859068ZM8.693471 0.41421363C8.4964828 1.6200291 7.7470469 2.6573901 6.6764607 3.2061374L1.9153781 5.599215L0 2.2249756C0.094158366 0.97545338 1.1171442 0.011679312 2.345361 0.015367369C7.4973373 0.015367369 7.8178697 -0.12024036 8.693471 0.41421363L8.693471 0.41421363Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(17.6623 16.248)" d="M29.76263 4.7861552C28.535225 2.7281084 24.290121 0 19.372681 0L20.881531 1.9304159C21.884367 3.2096772 22.266888 4.882844 21.922308 6.4828157C21.577726 8.0827875 20.542957 9.4381704 19.106874 10.17058C18.895792 10.27428 10.945018 14.358465 10.710482 14.358465L7.8178697 14.358465L7.8178697 21.537699L19.544674 21.537699L19.544674 19.144621C19.544075 15.666397 22.273432 12.828297 25.681702 12.763081C27.503265 11.965387 28.144331 11.773941 28.926119 11.048041C27.425188 10.616439 26.465275 9.1225128 26.67588 7.5459671C26.886488 5.9694219 28.203243 4.7921324 29.76263 4.7861552ZM11.726805 19.942312L10.163231 19.942312C9.7314615 19.942312 9.381444 19.585175 9.381444 19.144621C9.381444 18.704067 9.7314615 18.346928 10.163231 18.346928L11.726805 18.346928C12.158574 18.346928 12.508592 18.704067 12.508592 19.144621C12.508592 19.585175 12.158574 19.942312 11.726805 19.942312ZM6.2542958 16.304834L6.2542958 19.942312L0.78178698 19.942312C0.35001796 19.942312 0 19.585175 0 19.144621C0 18.704067 0.35001796 18.346928 0.78178698 18.346928C1.0163231 18.346928 0.66451895 18.450628 6.2542958 16.304834ZM10.945018 9.5723104C7.9429555 9.5723104 7.0986257 9.8355484 6.4810143 8.7746172L10.499399 8.7746172L10.945018 9.5723104Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(13.744 22.6295)" d="M16.153269 5.5120554L14.441155 6.3815403L11.110744 6.3815403L0.0093681542 1.5953851L0.0093681542 0L6.1307602 0C8.9921007 2.5366621 8.5621176 2.1697237 8.6715679 2.2415159C8.9720449 3.7241786 10.252333 4.7872415 11.736173 4.7861552L15.754558 4.7861552L16.153269 5.5120554ZM8.7497463 15.156157C7.7580099 16.902859 5.7988338 17.826883 3.8523138 17.465979C1.9057937 17.105076 0.39046192 15.536845 0.064376354 13.545808C-0.26170921 11.55477 0.671565 9.5690308 2.3973205 8.5819721C4.123076 7.5949144 6.2702479 7.8187714 7.7646952 9.1415558L4.5046434 10.370003C3.286221 10.473958 2.350477 11.515538 2.3547292 12.763081C2.3547292 14.084741 3.404783 15.156157 4.7000899 15.156157L8.7497463 15.156157Z" fill-rule="evenodd"/>
        `
            break
        case 'carType.tricycle':
        case 'VL':
            baseIcon = `
          <path fill="white" transform="translate(15.2065 16.7593)" d="M24.918026 0C24.918026 0 25.168867 1.1215779 25.204777 3.1120787C25.240692 5.1025796 24.472374 6.9810548 24.472374 6.9810548L22.741331 6.9810548C22.167587 6.9810061 21.634348 7.2697606 21.330553 7.7450042L18.532253 12.122904L15.559158 12.122904C14.840007 12.122912 14.257021 12.692161 14.257012 13.394366L14.257012 16.693907L9.5177717 16.693907L7.2140975 9.9536314C7.2140975 9.9536314 3.5377297 11.374935 2.6298614 12.418977C1.7219958 13.463018 1.4279692 14.603483 1.4279692 14.603483L0.92337674 14.603483C0.67848182 14.603483 0.44361696 14.698474 0.27045009 14.86756C0.097283192 15.036647 0 15.265978 0 15.505102L0 16.872906C0.74582326 16.247717 1.7145693 15.870834 2.7707081 15.870855L2.7708559 15.870855C5.0492477 15.870903 6.9227004 17.623062 7.0221167 19.844776L7.934514 20.108124L22.908762 20.108124C22.908243 20.080856 22.90732 20.053587 22.90732 20.026312C22.90732 19.979029 22.908125 19.931669 22.909775 19.884413L22.909775 19.85211L22.910929 19.85211C23.006517 17.626833 24.881927 15.87081 27.16291 15.870855L27.163059 15.870855C29.005527 15.870894 30.582745 17.016956 31.171629 18.630299L32.186016 18.445518C32.186016 18.445518 32.342213 16.38311 31.504171 14.503335C30.66613 12.623561 30.11434 12.122904 30.11434 12.122904L27.829155 12.122904C27.160475 10.636101 25.996237 7.6645708 26.201113 5.3673949C26.485514 2.1786151 25.980524 0 25.980524 0L24.918026 0Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(21.8378 16.248)" d="M1.0248863 0.0073442943L19.573336 0.0073442943C19.814102 -0.022974094 20.057343 0.041339956 20.249546 0.18613808C20.44175 0.33093619 20.567171 0.54435724 20.598221 0.77945095L0 0.77945095C0.031049781 0.54435742 0.15647215 0.33093649 0.34867561 0.18613839C0.54087907 0.041340299 0.78411931 -0.02297386 1.0248863 0.0073442943L1.0248863 0.0073442943Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(19.5671 16.4167)" d="M4.644196 0L0 11.966524L0.69177026 12.222424L5.3359661 0.2559L4.644196 0Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(22.5069 22.4633)" d="M4.6163054 0L4.3917227 0.21929115L5.0725121 1.6690311L0 6.622016L0.13514149 6.8525109L0.10470439 6.882237L0.17582959 6.9220209L0.2165736 6.9914675L0.24700789 6.9617419L0.4830687 7.093699L5.5555782 2.1407135L7.0403037 2.8054619L7.2648888 2.5861707L5.9965305 1.347701L5.8846641 1.2384697L4.6163054 0Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(14.492 33.3878)" d="M6.960166 3.3980792Q6.960166 3.5650163 6.9434085 3.7311492Q6.9266505 3.8972826 6.8932962 4.0610113Q6.8599429 4.224741 6.8103142 4.38449Q6.7606859 4.5442381 6.6952596 4.6984677Q6.6298342 4.8526974 6.5492415 4.9999228Q6.4686489 5.1471481 6.3736653 5.2859507Q6.2786827 5.4247541 6.1702232 5.5537977Q6.0617642 5.6828418 5.9408731 5.8008838Q5.8199825 5.9189262 5.6878242 6.0248299Q5.555666 6.1307335 5.4135132 6.2234783Q5.2713604 6.3162236 5.1205826 6.394917Q4.9698048 6.4736109 4.8118529 6.5374942Q4.6539021 6.6013784 4.4902983 6.649838Q4.3266945 6.6982975 4.1590133 6.730865Q3.991333 6.763433 3.8211911 6.7797956Q3.6510487 6.7961583 3.480083 6.7961583Q3.3091176 6.7961583 3.1389751 6.7797961Q2.968833 6.763433 2.8011522 6.730865Q2.633472 6.6982975 2.4698679 6.6498384Q2.3062642 6.6013794 2.1483126 6.5374947Q1.9903611 6.4736109 1.8395832 6.3949175Q1.688805 6.3162241 1.5466523 6.2234783Q1.4044998 6.1307335 1.2723416 6.0248299Q1.1401834 5.9189267 1.0192926 5.8008842Q0.8984018 5.6828423 0.78994244 5.5537977Q0.68148303 5.4247541 0.58649957 5.2859507Q0.49151629 5.1471481 0.41092372 4.9999228Q0.33033115 4.8526974 0.26490548 4.6984677Q0.19947985 4.5442381 0.14985117 4.3844895Q0.10022252 4.224741 0.066868804 4.0610113Q0.033515096 3.8972826 0.016757548 3.7311494Q0 3.5650163 0 3.3980792Q0 3.2311425 0.016757548 3.0650094Q0.033515096 2.8988762 0.066868804 2.7351468Q0.10022252 2.5714176 0.14985117 2.4116688Q0.19947985 2.2519202 0.26490548 2.0976903Q0.33033115 1.9434609 0.41092372 1.7962356Q0.49151632 1.6490104 0.58649963 1.5102074Q0.68148303 1.3714045 0.78994238 1.2423606Q0.8984018 1.1133165 1.0192926 0.99527431Q1.1401834 0.87723213 1.2723416 0.77132845Q1.4044998 0.66542482 1.5466522 0.57267958Q1.6888049 0.47993442 1.8395829 0.40124089Q1.9903611 0.32254738 2.1483126 0.25866336Q2.3062642 0.19477938 2.4698679 0.14632015Q2.633472 0.097860917 2.8011522 0.065293133Q2.968833 0.03272536 3.1389754 0.01636268Q3.3091176 0 3.480083 0Q3.6510487 0 3.8211908 0.01636268Q3.991333 0.03272536 4.1590133 0.065293133Q4.326694 0.097860917 4.4902978 0.14632015Q4.6539011 0.19477938 4.8118525 0.25866336Q4.9698043 0.32254738 5.1205826 0.40124089Q5.2713604 0.47993439 5.4135132 0.57267952Q5.555666 0.66542476 5.6878242 0.77132845Q5.8199825 0.87723213 5.9408727 0.99527431Q6.0617638 1.1133165 6.1702232 1.2423606Q6.2786827 1.3714045 6.3736658 1.5102074Q6.4686489 1.6490104 6.5492415 1.7962357Q6.6298342 1.9434609 6.6952596 2.0976903Q6.7606859 2.2519202 6.8103142 2.4116688Q6.8599429 2.5714176 6.8932962 2.7351468Q6.9266505 2.8988762 6.9434085 3.0650094Q6.960166 3.2311425 6.960166 3.3980792Z"/>
          <path fill="white" transform="translate(38.8847 33.3878)" d="M6.960166 3.3980792Q6.960166 3.5650163 6.9434085 3.7311492Q6.9266505 3.8972826 6.8932962 4.0610113Q6.8599429 4.224741 6.8103142 4.38449Q6.7606859 4.5442381 6.6952596 4.6984677Q6.6298342 4.8526974 6.5492415 4.9999228Q6.4686489 5.1471481 6.3736653 5.2859507Q6.2786827 5.4247541 6.1702232 5.5537977Q6.0617642 5.6828418 5.9408731 5.8008838Q5.8199825 5.9189262 5.6878242 6.0248299Q5.555666 6.1307335 5.4135132 6.2234783Q5.2713604 6.3162236 5.1205826 6.394917Q4.9698048 6.4736109 4.8118529 6.5374942Q4.6539021 6.6013784 4.4902983 6.649838Q4.3266945 6.6982975 4.1590133 6.730865Q3.991333 6.763433 3.8211911 6.7797956Q3.6510487 6.7961583 3.480083 6.7961583Q3.3091176 6.7961583 3.1389751 6.7797961Q2.968833 6.763433 2.8011522 6.730865Q2.633472 6.6982975 2.4698679 6.6498384Q2.3062642 6.6013794 2.1483126 6.5374947Q1.9903611 6.4736109 1.8395832 6.3949175Q1.688805 6.3162241 1.5466523 6.2234783Q1.4044998 6.1307335 1.2723416 6.0248299Q1.1401834 5.9189267 1.0192926 5.8008842Q0.8984018 5.6828423 0.78994244 5.5537977Q0.68148303 5.4247541 0.58649957 5.2859507Q0.49151629 5.1471481 0.41092372 4.9999228Q0.33033115 4.8526974 0.26490548 4.6984677Q0.19947985 4.5442381 0.14985117 4.3844895Q0.10022252 4.224741 0.066868804 4.0610113Q0.033515096 3.8972826 0.016757548 3.7311494Q0 3.5650163 0 3.3980792Q0 3.2311425 0.016757548 3.0650094Q0.033515096 2.8988762 0.066868804 2.7351468Q0.10022252 2.5714176 0.14985117 2.4116688Q0.19947985 2.2519202 0.26490548 2.0976903Q0.33033115 1.9434609 0.41092372 1.7962356Q0.49151632 1.6490104 0.58649963 1.5102074Q0.68148303 1.3714045 0.78994238 1.2423606Q0.8984018 1.1133165 1.0192926 0.99527431Q1.1401834 0.87723213 1.2723416 0.77132845Q1.4044998 0.66542482 1.5466522 0.57267958Q1.6888049 0.47993442 1.8395829 0.40124089Q1.9903611 0.32254738 2.1483126 0.25866336Q2.3062642 0.19477938 2.4698679 0.14632015Q2.633472 0.097860917 2.8011522 0.065293133Q2.968833 0.03272536 3.1389754 0.01636268Q3.3091176 0 3.480083 0Q3.6510487 0 3.8211908 0.01636268Q3.991333 0.03272536 4.1590133 0.065293133Q4.326694 0.097860917 4.4902978 0.14632015Q4.6539011 0.19477938 4.8118525 0.25866336Q4.9698043 0.32254738 5.1205826 0.40124089Q5.2713604 0.47993439 5.4135132 0.57267952Q5.555666 0.66542476 5.6878242 0.77132845Q5.8199825 0.87723213 5.9408727 0.99527431Q6.0617638 1.1133165 6.1702232 1.2423606Q6.2786827 1.3714045 6.3736658 1.5102074Q6.4686489 1.6490104 6.5492415 1.7962357Q6.6298342 1.9434609 6.6952596 2.0976903Q6.7606859 2.2519202 6.8103142 2.4116688Q6.8599429 2.5714176 6.8932962 2.7351468Q6.9266505 2.8988762 6.9434085 3.0650094Q6.960166 3.2311425 6.960166 3.3980792Z"/>
        `
            break
        case 'carType.bike':
            baseIcon = `
          <path fill="white" transform="translate(14.492 26.8692)" d="M6.0971546 6.5605526C5.9991064 6.3985624 5.9991064 6.1989827 6.0971546 6.0369925L9.0336704 0.44013155C8.2482986 0.1412762 7.4092169 -0.008126853 6.563704 0.00034079439C3.0003591 0.012165093 0.093010463 2.725004 0.0021798883 6.1228805C-0.088650689 9.5207567 2.6699772 12.371405 6.2280598 12.556437C9.7861423 12.741468 12.853312 10.193783 13.150281 6.8066263L6.563704 6.8066263C6.3740644 6.8069882 6.1976633 6.7139482 6.0971546 6.5605526Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(21.9449 26.8696)" d="M5.6973896 5.7591715C5.5218582 3.7591925 4.3551826 1.9595587 2.5577877 0.91623783L0 5.7591715L5.6973896 5.7591715ZM18.870544 3.524603e-06C18.067499 -0.00081053644 17.271156 0.13939704 16.521332 0.41361982L19.364538 6.057601C19.494055 6.3178816 19.378767 6.6290684 19.106564 6.7539363C19.033363 6.7890134 18.952459 6.8069601 18.870544 6.8062925C18.659412 6.8057222 18.467337 6.6896873 18.376551 6.507863L15.538834 0.86388177C12.691636 2.4573605 11.52083 5.8151464 12.80029 8.7178278C14.079749 11.620508 17.414238 13.171424 20.599745 12.345459C23.785252 11.519493 25.837746 8.5717926 25.400583 5.4507141C24.963421 2.3296351 22.171642 -0.00069753395 18.870544 3.524603e-06L18.870544 3.524603e-06Z" fill-rule="evenodd"/>
          <path fill="white" transform="translate(22.7023 18.492)" d="M12.272989 1.848779L14.468515 1.0110823C14.750434 0.90409511 14.88805 0.59936738 14.775888 0.33045375C14.663728 0.061540127 14.344262 -0.069727227 14.062343 0.03725991L11.317936 1.0843807C11.177036 1.1382407 11.06581 1.2453531 11.010694 1.3802606C10.955577 1.5151682 10.961491 1.6658243 11.027028 1.796423L12.503519 4.7126546L3.8421702 4.7126546L2.5248547 2.0948524L3.8421702 2.0948524C4.145309 2.0948524 4.3910518 1.8604463 4.3910518 1.5712919C4.3910518 1.2821375 4.145309 1.0477315 3.8421702 1.0477315L0.54888147 1.0477315C0.24574259 1.0477315 0 1.2821375 0 1.5712919C0 1.8604463 0.24574259 2.0948524 0.54888147 2.0948524L1.3008491 2.0948524L2.782829 5.0424976L0.80136693 8.8278389C1.1396769 8.957777 1.4664123 9.1136084 1.7783759 9.293808L3.3865986 6.2362151L7.3605003 14.136742L4.9399333 14.136742C4.9399333 14.309517 4.9399333 14.482292 4.9399333 14.660302C4.9399333 14.838313 4.9399333 15.011087 4.9399333 15.183863L8.233222 15.183863C8.3071766 15.182076 8.3799887 15.166049 8.4472857 15.136743L8.4472857 15.136743L8.4472857 15.136743C8.5048923 15.108996 8.5569181 15.071776 8.6009722 15.026794L8.6009722 14.995381C8.6238995 14.969392 8.6441202 14.941337 8.6613493 14.911612L13.266464 6.2309794L14.781378 9.2414522C15.095007 9.0652542 15.423674 8.9146318 15.763875 8.7911901L12.272989 1.848779ZM8.233222 13.47182L4.3636074 5.7597752L12.283967 5.7597752L8.233222 13.47182Z" fill-rule="evenodd"/>
        `
            break
        case 'PL':
            baseIcon = `
          <path fill="white" transform="matrix(-1 0 0 1 48.4 19.988)" d="M26.669859 0.85101807L26.669859 11.394187C26.671438 11.620913 26.581055 11.838894 26.418741 11.999771C26.256428 12.160648 26.035604 12.251115 25.805262 12.251115L10.272897 12.251115C9.166543 11.163771 7.374577 11.163771 6.2682238 12.251115L0.86461812 12.251115C0.63427401 12.251115 0.41345069 12.160648 0.25113738 11.999771C0.088824041 11.838894 -0.0015583956 11.620913 2.0339785e-05 11.394187L2.0339785e-05 0.85101807C2.0339785e-05 0.38101378 0.38712549 0 0.86461812 0L25.805262 0C26.282753 0 26.669859 0.38101378 26.669859 0.85101807L26.669859 0.85101807ZM27.006062 13.019395L27.006062 14.650513L11.083437 14.650513C11.107585 14.511914 11.119637 14.371535 11.119461 14.230913C11.120771 13.807357 11.024279 13.389045 10.837273 13.007575L27.006062 13.019395ZM33.838623 4.8401656L28.933348 4.8401656C28.657869 4.8401656 28.393675 4.9478827 28.198881 5.1396203C28.004089 5.3313584 27.894655 5.5914106 27.894655 5.8625689L27.894655 12.522967C28.411289 11.867959 29.196201 11.471919 30.038086 11.441465C30.979052 11.404328 31.877523 11.828747 32.436768 12.57455C32.99601 13.320353 33.143284 14.290531 32.829948 15.16467L33.310268 15.16467L35.111469 14.815989C35.57159 14.728252 35.903999 14.331738 35.903999 13.870413L35.903999 8.8470421L34.805267 5.5434375C34.666054 5.1317534 34.279305 4.8503761 33.838623 4.8401656L33.838623 4.8401656ZM30.80056 8.3210659L30.80056 6.3176274C30.80056 5.9249897 31.122196 5.6057806 31.521076 5.6025357L33.004066 5.6025357C33.480251 5.6041613 33.895061 5.9225435 34.012737 6.3767257L34.451031 8.0787621C34.510109 8.262949 34.474022 8.4639292 34.354382 8.6170235C34.234741 8.7701178 34.046646 8.8560047 33.850628 8.8470421L31.328947 8.8470421C31.187773 8.8470516 31.052465 8.7914476 30.953207 8.6926346C30.853947 8.5938215 30.79899 8.4600172 30.80056 8.3210659L30.80056 8.3210659Z" fill-rule="evenodd"/>
          <path fill="white" transform="matrix(-1 0 0 1 42.3741 32.0145)" d="M4.1149378 0.99292547C3.8930829 0.6594466 3.5812221 0.393406 3.2143369 0.22464524C2.9136839 0.078351513 2.5830712 0.0015424358 2.2476919 7.1018192e-05C1.9121352 7.1018192e-05 1.5811837 0.07694456 1.2810469 0.22464524C0.37332273 0.64781982 -0.13715208 1.6141068 0.032213509 2.5885844C0.22589526 3.6400476 1.1560557 4.4045429 2.241688 4.4045429C3.3273201 4.4045429 4.2574806 3.6400476 4.4511623 2.5885844C4.4773235 2.4501567 4.4913845 2.3097765 4.4931903 2.1689851C4.483716 1.7494663 4.3524642 1.3413792 4.1149378 0.99292547L4.1149378 0.99292547ZM2.2476919 3.1322904C1.8677807 3.13468 1.5240374 2.910938 1.377528 2.5659022C1.2310185 2.2208664 1.3107698 1.8228958 1.5794132 1.5584656C1.8480564 1.2940353 2.2523677 1.2155347 2.6029007 1.3597465C2.9534338 1.5039582 3.1807406 1.8423108 3.178313 2.216264C3.178313 2.4592092 3.0802655 2.6922042 2.9057403 2.8639925C2.731215 3.0357807 2.494508 3.1322904 2.2476919 3.1322904L2.2476919 3.1322904ZM24.096272 7.1018192e-05C23.465635 0.020338422 22.871336 0.29544395 22.45327 0.760629C22.035202 1.2258141 21.830301 1.8399847 21.886797 2.4585676C21.910234 2.6943793 21.97525 2.9243653 22.078926 3.1382003C22.442528 3.9246805 23.239433 4.4295306 24.117285 4.4295306C24.995138 4.4295306 25.792042 3.9246805 26.155645 3.1382003C26.293486 2.8497598 26.365225 2.5350208 26.365786 2.216264C26.365786 1.6254083 26.126123 1.0590073 25.699982 0.6428771C25.273838 0.22674687 24.696522 -0.0046558278 24.096272 7.1018192e-05L24.096272 7.1018192e-05ZM24.096272 3.1322904C23.716898 3.1322904 23.374996 2.9070153 23.230383 2.5617852C23.08577 2.2165551 23.167011 1.8195546 23.436131 1.5563539C23.70525 1.2931533 24.109089 1.2157418 24.458881 1.360304C24.808676 1.5048661 25.035328 1.8428471 25.032896 2.216264C25.032938 2.7175913 24.623556 3.1258216 24.114283 3.1322904L24.096272 3.1322904Z" fill-rule="evenodd"/>
        `
            break
    }
    const svgMarker = `
      <svg xmlns="http://www.w3.org/2000/svg" width="63" height="66">
        <path fill="none" transform="translate(5.5 3.5)" d="M0 0L50 0L50 54L0 54L0 0Z" />
        <path transform="translate(5.5 3.5)" d="M25.431999 -1.5C32.86507 -1.5 39.592987 1.4471931 44.463596 6.2076082C49.346771 10.980306 52.363998 17.574583 52.363998 24.856615C52.363998 31.579639 48.701218 38.685665 43.744114 44.338112C37.996067 50.892441 30.5851 55.355999 25.431999 55.355999C20.2789 55.355999 12.867931 50.892441 7.1198874 44.338112C2.1627824 38.685665 -1.5 31.579639 -1.5 24.856615C-1.5 17.574583 1.5172284 10.980306 6.4004045 6.2076082C11.271014 1.4471931 17.99893 -1.5 25.431999 -1.5Z" />
        <path fill="${fill ?? '#d83939ff'}" transform="translate(5.5 3.5)" d="M25.431999 53.855999C34.545868 53.855999 50.863998 38.584545 50.863998 24.856615C50.863998 11.128686 39.477707 0 25.431999 0C11.386294 0 0 11.128686 0 24.856615C0 38.584545 16.318134 53.855999 25.431999 53.855999Z" fill-rule="evenodd" />
        <path fill="none" stroke="${outline ?? 'white'}" stroke-width="3" stroke-miterlimit="10" transform="translate(5.5 3.5)" d="M25.431999 53.855999C34.545868 53.855999 50.863998 38.584545 50.863998 24.856615C50.863998 11.128686 39.477707 0 25.431999 0C11.386294 0 0 11.128686 0 24.856615C0 38.584545 16.318134 53.855999 25.431999 53.855999Z" fill-rule="evenodd" />
        ${baseIcon}
      </svg>
    `
    const svgUrl = `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svgMarker)}`;
    return svgUrl
};

const getMarkerIcon = (vehicle: IVehicle, isSelected: boolean): google.maps.Icon => {
    const fillColor = getMarkerColor(vehicle);
    const outlineColor = getOutlineColor(isSelected);

    return {
        url: createVehicleIcon(fillColor, outlineColor, GetVehicleCarmooveType(vehicle.information.kindCG)),
        scaledSize: new google.maps.Size(isSelected ? 40 : 35, isSelected ? 40 : 35),
        anchor: new google.maps.Point(isSelected ? 15 : 12, isSelected ? 30 : 25),
    };
};

export default function CarmooveGMap({vehicles, reservations, selectedVehicle, onSelectVehicle}: ICarmooveGMap) {
    const [infoWindowVehicle, setInfoWindowVehicle] = useState<IVehicle | null>(null);
    const mapRef = useRef<google.maps.Map | null>(null);

    const { isLoaded, loadError } = useJsApiLoader({
        googleMapsApiKey: process.env.REACT_APP_GMAP_KEY!,
        id: 'google-map-script',
    });

    const onMapLoad = useCallback((map: google.maps.Map) => {
        mapRef.current = map;

        if (vehicles.length > 0) {
            const bounds = new google.maps.LatLngBounds();
            vehicles.forEach(vehicle => {
                if (vehicle.location?.latitude && vehicle.location?.longitude) {
                    bounds.extend({
                        lat: vehicle.location.latitude,
                        lng: vehicle.location.longitude
                    });
                }
            });

            if (!bounds.isEmpty()) {
                map.fitBounds(bounds, { top: 50, right: 50, bottom: 50, left: 50 });
            }
        }
    }, [vehicles]);

    const handleMarkerClick = (vehicle: IVehicle) => {
        onSelectVehicle(vehicle);
        setInfoWindowVehicle(vehicle);

        if (mapRef.current && vehicle.location) {
            mapRef.current.panTo({
                lat: vehicle.location.latitude,
                lng: vehicle.location.longitude
            });
        }
    };

    const isVehicleReserved = (vehicleId: string): boolean => {
        const now = Date.now();
        return reservations.some(
            r => r.vehicleId === vehicleId && r.from <= now && r.until >= now
        );
    };

    if (loadError) {
        return <div className="map-error">Erreur de chargement de la carte</div>;
    }

    if (!isLoaded) {
        return <div className="map-loading">Chargement de la carte...</div>;
    }

    const validVehicles = vehicles.filter(
        v => v.location?.latitude && v.location?.longitude
    );

    return (
        <GoogleMap
            mapContainerStyle={mapContainerStyle}
            center={selectedVehicle?.location ? {
                lat: selectedVehicle.location.latitude,
                lng: selectedVehicle.location.longitude
            } : defaultCenter}
            zoom={10}
            options={mapOptions}
            mapTypeId='roadmap'
            onLoad={onMapLoad}
            onClick={() => setInfoWindowVehicle(null)}
        >
            {validVehicles.map((vehicle) => (
                <Marker
                    key={vehicle.id}
                    position={{
                        lat: vehicle.location.latitude,
                        lng: vehicle.location.longitude
                    }}
                    icon={getMarkerIcon(vehicle, selectedVehicle?.id === vehicle.id)}
                    onClick={() => handleMarkerClick(vehicle)}
                    title={vehicle.information.registration}
                />
            ))}

            {infoWindowVehicle && infoWindowVehicle.location && (
                <InfoWindow
                    position={{
                        lat: infoWindowVehicle.location.latitude,
                        lng: infoWindowVehicle.location.longitude
                    }}
                    onCloseClick={() => setInfoWindowVehicle(null)}
                >
                    <div className="info-window-content">
                        <div>
                            <span>{infoWindowVehicle.information.registration}</span>
                        </div>
                        <div>
                            {infoWindowVehicle.information.make} {infoWindowVehicle.information.model}
                        </div>
                        <div style={{ marginTop: 8, fontSize: 12 }}>
                            {infoWindowVehicle.stateCS?.state?.unavailable ? (
                                <span style={{ color: "#ff4d4f" }}>Indisponible</span>
                            ) : isVehicleReserved(infoWindowVehicle.id) ? (
                                <span style={{ color: "#faad14" }}>Reserv</span>
                            ) : (
                                <span style={{ color: "#52c41a" }}>Disponible</span>
                            )}
                        </div>
                        {infoWindowVehicle.location.address && (
                            <div style={{ marginTop: 4, fontSize: 11, color: "#888" }}>
                                {infoWindowVehicle.location.address.address}
                                {infoWindowVehicle.location.address.city &&
                                    `, ${infoWindowVehicle.location.address.city}`}
                            </div>
                        )}
                    </div>
                </InfoWindow>
            )}
        </GoogleMap>
    );
}
